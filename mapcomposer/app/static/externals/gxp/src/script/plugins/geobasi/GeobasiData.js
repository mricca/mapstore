/**
 *  Copyright (C) 2007 - 2012 GeoSolutions S.A.S.
 *  http://www.geo-solutions.it
 *
 *  GPLv3 + Classpath exception
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
/**
 * @requires plugins/Tool.js
 */
/**
 * @author Riccardo Mari
 */
/** api: (define)
 *  module = gxp.plugins
 *  class = GeobasiData
 */
/** api: (extends)
 *  plugins/Tool.js
 */
Ext.namespace("gxp.plugins.geobasi");

/** api: constructor
 *  .. class:: GeobasiData(config)
 *
 *    Plugin for adding MainGeobasi GeobasiData Module to a :class:`gxp.Viewer`.
 */
gxp.plugins.geobasi.GeobasiData = Ext.extend(gxp.plugins.Tool, {

		/** api: ptype = gxp_geobasidata */
		ptype : "gxp_geobasidata",
		selTipo : 'Seleziona',
		selMonitoraggio : 'Monitoraggio',
		selMatrixMethod : 'Metodo selezione Matrice',
		selElabMethod : 'Seleziona tipologia valori',
		dataUrl : null,
		mainLoadingMask : "Caricamento date in corso...",
		getWFSStoreProxyProp: {
			wfsURL : "http://www506.regione.toscana.it/geoserver/wfs",
			featureNS : 'http://geobasi',
            outputFormat : "application/json",
            wfsVersion : '1.1.0'
		},

		/** private: method[init]
		 *  :arg target: ``Object``
		 *
		 *  Provide the initialization code defining necessary listeners and controls.
		 */
		init : function (target) {
			target.on({
				scope : this,
				'ready' : function () {
					//
					// Show the Time Slider only when this tool is activated
					//
					this.output.on("show", function () {
						//this.setMinMaxValues();
					}, this);
				}
			});
			return gxp.plugins.geobasi.GeobasiData.superclass.init.apply(this, arguments);
		},
		/** private: method[addOutput]
		 *  :arg config: ``Object``
		 */
		addOutput : function (config) {
            
            var me = this;
			
            this._newMonitoringViewparams = ' IS NOT NULL';
			this._newMatrixViewparams = '01';
			this._newElementViewparams = 'Ca';
            this._newGeometryViewparams = 'POLYGON((965523.68377232947386801 5388020.56055717170238495\\,2315632.81207791296765208 5389637.45771681889891624\\,2317249.70923756016418338 5389637.45771681889891624\\,2317249.70923756016418338 4383927.4244161332026124\\,965523.68377232959028333 4383927.4244161332026124\\,965523.68377232947386801 5388020.56055717170238495))';
            //this._newGeometryViewparams = 'MULTIPOLYGON(((1642634 4754533\\,1642650 4754569\\,1642695 4754549\\,1642757 4754683\\,1642742 4754747\\,1642674 4754826\\,1642675 4754868\\,1642704 4754886\\,1642749 4754880\\,1642785 4754895\\,1642833 4754774\\,1642892 4754770\\,1642921 4754782\\,1642946 4754831\\,1643052 4754925\\,1642955 4754971\\,1642895 4755034\\,1642875 4755221\\,1642835 4755385\\,1642723 4755449\\,1642694 4755496\\,1642703 4755646\\,1642662 4755783\\,1642675 4755998\\,1642643 4756051\\,1642639 4756141\\,1642658 4756244\\,1642549 4756519\\,1642496 4756596\\,1642440 4756644\\,1642437 4756672\\,1642300 4756762\\,1642192 4756931\\,1642161 4757031\\,1642187 4757120\\,1642148 4757251\\,1642164 4757356\\,1642180 4757371\\,1642188 4757292\\,1642289 4757196\\,1642347 4757196\\,1642374 4757164\\,1642410 4757154\\,1642444 4757162\\,1642489 4757202\\,1642518 4757190\\,1642448 4756998\\,1642456 4756914\\,1642505 4756862\\,1642640 4756817\\,1642677 4756791\\,1642714 4756655\\,1642656 4756562\\,1642763 4756451\\,1642809 4756259\\,1642859 4756190\\,1642868 4756146\\,1643017 4755876\\,1643083 4755807\\,1643127 4755784\\,1643232 4755799\\,1643303 4755854\\,1643344 4755863\\,1643390 4755819\\,1643376 4755941\\,1643468 4756097\\,1643471 4756197\\,1643499 4756324\\,1643488 4756599\\,1643455 4756665\\,1643482 4756668\\,1643497 4756646\\,1643558 4756499\\,1643596 4756355\\,1643633 4756502\\,1643633 4756559\\,1643614 4756607\\,1643625 4756689\\,1643662 4756635\\,1643721 4756615\\,1643772 4756630\\,1643837 4756690\\,1643847 4756754\\,1643799 4756969\\,1643812 4756974\\,1643846 4756946\\,1643924 4756840\\,1643993 4756676\\,1644001 4756535\\,1644096 4756414\\,1644169 4756365\\,1644225 4756426\\,1644204 4756515\\,1644218 4756547\\,1644313 4756593\\,1644348 4756684\\,1644347 4756744\\,1644370 4756753\\,1644440 4756703\\,1644474 4756715\\,1644520 4756770\\,1644530 4756870\\,1644464 4756985\\,1644288 4757183\\,1644167 4757243\\,1644101 4757302\\,1644173 4757284\\,1644200 4757292\\,1644249 4757357\\,1644260 4757409\\,1644240 4757542\\,1644176 4757643\\,1644147 4757748\\,1644186 4757724\\,1644198 4757686\\,1644277 4757683\\,1644276 4757748\\,1644319 4757712\\,1644332 4757661\\,1644317 4757478\\,1644415 4757202\\,1644442 4757168\\,1644564 4757142\\,1644659 4757183\\,1644859 4757118\\,1644968 4757162\\,1645010 4757243\\,1645007 4757291\\,1644934 4757490\\,1644921 4757589\\,1644861 4757705\\,1645040 4757677\\,1645074 4757687\\,1645084 4757784\\,1645039 4757930\\,1645053 4757964\\,1645123 4757997\\,1645157 4758075\\,1645152 4758277\\,1645230 4758265\\,1645274 4758279\\,1645416 4758386\\,1645460 4758438\\,1645469 4758536\\,1645498 4758618\\,1645502 4758685\\,1645462 4758816\\,1645343 4758976\\,1645494 4758905\\,1645580 4758900\\,1645589 4758915\\,1645568 4758988\\,1645639 4758981\\,1645732 4758999\\,1645759 4759051\\,1645752 4759128\\,1645830 4759159\\,1645887 4759268\\,1645964 4759303\\,1646231 4759392\\,1646274 4759419\\,1646264 4759478\\,1646223 4759520\\,1646082 4759584\\,1646121 4759605\\,1646292 4759625\\,1646323 4759657\\,1646229 4759949\\,1646438 4759934\\,1646605 4759883\\,1646670 4759894\\,1646782 4759838\\,1646838 4759840\\,1646861 4759874\\,1646879 4759977\\,1646913 4760048\\,1646920 4760153\\,1646986 4760357\\,1646988 4760432\\,1646943 4760522\\,1646693 4760800\\,1646650 4760900\\,1646600 4761302\\,1646593 4761480\\,1646481 4761620\\,1646181 4762268\\,1646111 4762342\\,1646106 4762436\\,1646087 4762485\\,1646035 4762561\\,1645953 4762623\\,1645682 4762522\\,1645604 4762506\\,1645431 4762503\\,1645345 4762441\\,1645345 4762512\\,1645317 4762537\\,1645147 4762614\\,1645018 4762705\\,1644870 4762670\\,1644963 4762749\\,1644977 4762781\\,1644881 4763005\\,1644830 4763055\\,1644774 4763037\\,1644783 4763099\\,1644763 4763157\\,1644682 4763242\\,1644620 4763234\\,1644636 4763273\\,1644622 4763303\\,1644393 4763332\\,1644175 4763185\\,1644146 4763131\\,1644179 4762940\\,1644261 4762929\\,1644239 4762871\\,1644368 4762691\\,1644368 4762680\\,1644354 4762684\\,1644301 4762733\\,1644259 4762729\\,1644245 4762716\\,1644221 4762595\\,1644215 4762449\\,1644293 4762238\\,1644265 4762236\\,1644178 4762390\\,1644177 4762675\\,1644155 4762738\\,1644112 4762789\\,1644077 4762747\\,1644005 4762483\\,1643937 4762402\\,1643917 4762402\\,1643988 4762624\\,1643963 4762769\\,1643983 4762841\\,1643971 4762955\\,1644024 4763064\\,1644004 4763166\\,1644037 4763250\\,1644068 4763274\\,1644073 4763297\\,1644033 4763362\\,1643966 4763399\\,1643940 4763438\\,1643914 4763442\\,1643913 4763532\\,1643762 4763741\\,1643522 4763739\\,1643329 4763609\\,1643363 4763684\\,1643402 4763708\\,1643452 4763830\\,1643455 4763875\\,1643426 4763943\\,1643316 4763966\\,1643351 4764020\\,1643345 4764056\\,1643327 4764072\\,1643255 4764074\\,1643246 4764166\\,1643188 4764214\\,1643258 4764207\\,1643370 4764077\\,1643545 4763923\\,1643608 4763890\\,1643734 4763896\\,1643771 4763840\\,1643885 4763784\\,1643925 4763730\\,1643993 4763690\\,1644094 4763673\\,1644128 4763619\\,1644224 4763535\\,1644236 4763479\\,1644258 4763456\\,1644302 4763450\\,1644328 4763533\\,1644439 4763487\\,1644555 4763470\\,1644629 4763441\\,1644758 4763345\\,1644817 4763279\\,1645112 4762757\\,1645198 4762702\\,1645247 4762691\\,1645396 4762691\\,1645476 4762721\\,1645543 4762667\\,1645678 4762647\\,1645806 4762730\\,1645847 4762778\\,1645862 4762819\\,1645851 4762895\\,1645767 4762975\\,1645760 4763015\\,1645602 4763214\\,1645645 4763191\\,1645735 4763086\\,1645793 4762965\\,1645828 4762943\\,1645906 4762929\\,1646058 4762831\\,1646120 4762846\\,1646182 4762926\\,1646157 4763156\\,1646139 4763198\\,1646248 4763103\\,1646231 4763014\\,1646239 4762975\\,1646298 4762882\\,1646359 4762872\\,1646509 4762961\\,1646514 4762988\\,1646456 4763003\\,1646451 4763040\\,1646538 4763032\\,1646560 4762968\\,1646554 4763244\\,1646627 4763260\\,1646610 4763375\\,1646660 4763425\\,1646670 4763411\\,1646636 4763382\\,1646635 4763308\\,1646686 4763254\\,1646618 4763218\\,1646595 4763181\\,1646592 4763011\\,1646613 4762987\\,1646671 4762988\\,1646691 4762975\\,1646613 4762951\\,1646556 4762751\\,1646584 4762757\\,1646593 4762710\\,1646647 4762659\\,1646706 4762684\\,1646668 4762639\\,1646697 4762600\\,1646797 4762576\\,1646843 4762591\\,1646939 4762564\\,1647031 4762389\\,1647089 4762375\\,1647140 4762398\\,1647055 4762303\\,1647035 4762250\\,1647134 4762286\\,1647246 4762282\\,1647269 4762259\\,1647273 4762228\\,1647257 4762163\\,1647325 4762158\\,1647385 4762217\\,1647414 4762226\\,1647505 4762107\\,1647513 4761620\\,1647606 4760747\\,1647629 4760773\\,1647653 4760754\\,1647585 4760569\\,1647585 4760492\\,1647762 4760007\\,1647836 4759908\\,1647889 4759894\\,1648052 4760093\\,1648150 4760422\\,1648257 4760472\\,1648400 4760567\\,1648422 4760698\\,1648405 4760864\\,1648427 4760962\\,1648405 4761021\\,1648421 4761053\\,1648421 4761142\\,1648447 4761208\\,1648434 4761350\\,1648358 4761454\\,1648433 4761416\\,1648463 4761440\\,1648541 4761835\\,1648523 4761909\\,1648444 4761999\\,1648525 4761953\\,1648567 4761959\\,1648628 4762118\\,1648599 4762461\\,1648443 4762769\\,1648440 4762805\\,1648530 4762698\\,1648551 4762691\\,1648576 4762714\\,1648563 4762792\\,1648568 4762952\\,1648494 4763085\\,1648573 4763016\\,1648591 4763018\\,1648633 4763261\\,1648653 4763196\\,1648670 4763192\\,1648752 4763278\\,1648730 4763225\\,1648632 4763089\\,1648637 4763006\\,1648606 4762938\\,1648610 4762866\\,1648637 4762791\\,1648632 4762717\\,1648651 4762675\\,1648654 4762529\\,1648690 4762466\\,1648670 4761907\\,1648650 4761685\\,1648559 4761312\\,1648514 4760924\\,1648523 4760878\\,1648578 4760778\\,1648571 4760687\\,1648608 4760665\\,1648643 4760674\\,1648813 4760790\\,1648877 4760893\\,1648881 4760959\\,1648772 4761270\\,1648758 4761377\\,1648790 4761526\\,1648877 4761711\\,1648944 4761771\\,1648940 4761867\\,1648972 4762118\\,1648940 4762295\\,1648944 4762351\\,1648958 4762422\\,1648997 4762475\\,1649005 4762532\\,1648985 4762908\\,1648994 4762982\\,1649051 4763143\\,1649113 4763556\\,1649112 4763587\\,1649079 4763638\\,1649069 4763742\\,1649017 4763884\\,1649009 4764107\\,1649041 4764140\\,1649046 4764123\\,1649059 4763851\\,1649116 4763633\\,1649132 4763597\\,1649160 4763580\\,1649140 4763394\\,1649168 4763390\\,1649285 4763551\\,1649344 4763584\\,1649358 4763576\\,1649282 4763512\\,1649104 4763285\\,1649098 4763188\\,1649041 4763039\\,1649011 4762895\\,1649012 4762880\\,1649034 4762903\\,1649020 4762814\\,1649040 4762655\\,1649033 4762398\\,1649047 4762354\\,1649080 4762335\\,1649130 4762264\\,1649140 4762199\\,1649184 4762119\\,1649116 4762042\\,1649096 4761969\\,1649057 4761912\\,1649055 4761854\\,1649078 4761786\\,1649143 4761740\\,1649116 4761666\\,1649169 4761641\\,1649180 4761611\\,1649148 4761566\\,1649166 4761474\\,1649084 4761407\\,1649087 4761353\\,1649049 4761301\\,1649035 4761185\\,1649005 4761095\\,1649004 4761012\\,1649027 4760980\\,1649062 4760992\\,1649287 4761272\\,1649381 4761362\\,1649156 4761071\\,1649077 4760914\\,1649001 4760840\\,1648975 4760754\\,1648925 4760682\\,1648940 4760669\\,1649051 4760718\\,1649113 4760689\\,1649202 4760746\\,1649225 4760737\\,1649231 4760684\\,1649249 4760683\\,1649311 4760718\\,1649319 4760752\\,1649405 4760858\\,1649415 4760828\\,1649346 4760742\\,1649350 4760680\\,1649294 4760609\\,1649357 4760603\\,1649426 4760647\\,1649489 4760594\\,1649482 4760582\\,1649428 4760591\\,1649388 4760578\\,1649271 4760590\\,1649230 4760570\\,1649136 4760461\\,1649074 4760431\\,1648979 4760334\\,1648928 4760312\\,1648898 4760252\\,1648619 4760044\\,1648593 4759990\\,1648576 4759823\\,1648484 4759659\\,1648485 4759440\\,1648456 4759302\\,1648470 4758682\\,1648498 4758607\\,1648531 4758592\\,1648604 4758627\\,1648732 4758627\\,1648789 4758612\\,1648870 4758546\\,1648968 4758556\\,1649018 4758629\\,1649023 4758727\\,1648971 4758807\\,1648980 4758813\\,1649202 4758615\\,1649275 4758531\\,1649338 4758319\\,1649369 4758281\\,1649412 4758287\\,1649515 4758395\\,1649685 4758302\\,1649787 4758315\\,1649833 4758347\\,1649883 4758453\\,1649938 4758470\\,1649895 4758311\\,1649890 4758223\\,1649930 4758141\\,1650001 4758123\\,1650137 4758194\\,1650198 4758211\\,1650243 4758203\\,1650316 4758264\\,1650420 4758413\\,1650437 4758591\\,1650598 4758587\\,1650688 4758655\\,1650778 4758595\\,1650871 4758596\\,1650934 4758616\\,1651057 4758563\\,1651112 4758465\\,1651160 4758451\\,1651227 4758497\\,1651333 4758708\\,1651507 4758761\\,1651520 4758733\\,1651467 4758686\\,1651407 4758576\\,1651409 4758502\\,1651436 4758409\\,1651484 4758368\\,1651723 4758385\\,1651590 4758137\\,1651607 4758056\\,1651650 4758036\\,1651721 4758049\\,1651781 4758085\\,1652041 4758448\\,1652116 4758515\\,1652091 4758395\\,1651969 4758115\\,1651791 4757837\\,1651800 4757799\\,1651910 4757717\\,1652041 4757733\\,1652030 4757671\\,1652013 4757649\\,1651826 4757620\\,1651668 4757531\\,1651605 4757477\\,1651590 4757399\\,1651656 4757261\\,1651783 4757181\\,1651771 4757143\\,1651711 4757074\\,1651680 4756997\\,1651670 4756929\\,1651688 4756876\\,1651775 4756849\\,1651914 4756848\\,1652071 4756813\\,1652078 4756716\\,1652099 4756709\\,1652224 4756835\\,1652262 4756856\\,1652455 4756884\\,1652530 4756957\\,1652713 4757078\\,1652906 4757159\\,1652985 4757247\\,1653076 4757535\\,1653165 4757618\\,1653212 4757635\\,1653251 4757594\\,1653319 4757448\\,1653341 4757314\\,1653286 4757132\\,1653063 4756873\\,1653063 4756843\\,1653105 4756770\\,1653171 4756756\\,1653249 4756783\\,1653342 4756880\\,1653452 4756906\\,1653546 4756986\\,1653610 4757082\\,1653639 4757100\\,1653808 4757054\\,1653912 4757087\\,1653976 4757077\\,1654033 4757091\\,1654051 4757116\\,1654064 4757208\\,1654027 4757288\\,1653983 4757315\\,1653783 4757342\\,1653761 4757360\\,1653754 4757399\\,1653794 4757467\\,1653876 4757517\\,1653979 4757643\\,1654008 4757859\\,1654036 4757917\\,1654068 4757941\\,1654219 4757902\\,1654288 4757913\\,1654354 4757954\\,1654388 4757955\\,1654406 4757924\\,1654342 4757790\\,1654359 4757729\\,1654389 4757691\\,1654481 4757642\\,1654653 4757621\\,1654758 4757565\\,1654879 4757578\\,1655082 4757629\\,1655249 4757556\\,1655322 4757558\\,1655413 4757599\\,1655484 4757708\\,1655530 4757739\\,1655564 4757739\\,1655628 4757689\\,1655674 4757703\\,1655874 4757893\\,1655876 4757837\\,1656000 4757691\\,1656087 4757659\\,1656253 4757538\\,1656290 4757528\\,1656450 4757542\\,1656549 4757598\\,1656641 4757721\\,1656673 4757733\\,1656691 4757693\\,1656685 4757607\\,1656704 4757502\\,1656740 4757453\\,1656911 4757431\\,1656944 4757397\\,1656947 4757338\\,1656967 4757315\\,1657094 4757381\\,1657153 4757310\\,1657224 4757327\\,1657259 4757319\\,1657303 4757279\\,1657346 4757283\\,1657410 4757345\\,1657433 4757493\\,1657493 4757487\\,1657507 4757503\\,1657501 4757548\\,1657583 4757540\\,1657725 4757617\\,1657580 4757446\\,1657448 4757256\\,1657286 4757105\\,1657456 4757084\\,1657626 4757030\\,1657732 4756976\\,1657715 4756841\\,1657660 4756861\\,1657278 4756911\\,1656966 4756905\\,1656890 4756892\\,1656839 4756863\\,1656755 4756872\\,1656713 4756904\\,1656688 4756904\\,1656703 4756828\\,1656695 4756757\\,1656722 4756696\\,1656721 4756520\\,1656742 4756490\\,1656712 4756500\\,1656708 4756490\\,1656707 4756382\\,1656685 4756395\\,1656546 4756261\\,1656496 4756235\\,1656672 4756408\\,1656694 4756454\\,1656692 4756500\\,1656711 4756517\\,1656690 4756655\\,1656701 4756692\\,1656595 4756838\\,1656481 4756892\\,1656386 4756878\\,1656336 4756837\\,1656274 4756897\\,1656150 4756846\\,1656066 4756835\\,1656040 4756795\\,1655921 4756768\\,1655796 4756574\\,1655843 4756482\\,1655905 4756422\\,1655824 4756408\\,1655792 4756353\\,1655799 4756238\\,1655875 4756137\\,1655914 4756032\\,1655898 4756010\\,1655909 4755938\\,1655893 4755908\\,1655859 4755939\\,1655786 4755868\\,1655812 4755644\\,1655873 4755557\\,1655964 4755503\\,1655929 4755465\\,1655851 4755444\\,1655840 4755433\\,1655849 4755418\\,1655774 4755460\\,1655758 4755498\\,1655760 4755561\\,1655705 4755613\\,1655594 4755657\\,1655495 4755645\\,1655456 4755577\\,1655443 4755462\\,1655305 4755297\\,1655247 4755255\\,1655146 4755278\\,1655101 4755259\\,1655103 4755216\\,1655157 4755106\\,1655269 4754989\\,1655165 4755032\\,1655112 4755020\\,1655091 4754976\\,1655073 4754984\\,1655115 4754935\\,1655194 4754886\\,1655261 4754795\\,1655210 4754811\\,1655163 4754795\\,1655123 4754828\\,1655000 4754846\\,1654899 4754792\\,1654897 4754770\\,1654808 4754686\\,1654786 4754480\\,1654848 4754393\\,1655114 4754229\\,1655218 4754184\\,1655250 4754147\\,1655115 4754165\\,1654930 4754270\\,1654838 4754304\\,1654742 4754304\\,1654606 4754268\\,1654641 4754102\\,1654623 4754026\\,1654581 4753969\\,1654539 4753942\\,1654530 4753848\\,1654440 4753824\\,1654419 4753737\\,1654356 4753715\\,1654316 4753658\\,1654337 4753525\\,1654294 4753311\\,1654279 4753405\\,1654301 4753558\\,1654271 4753652\\,1654280 4753703\\,1654251 4753707\\,1654193 4753679\\,1654281 4753794\\,1654279 4753848\\,1654220 4753943\\,1654151 4753994\\,1654050 4753934\\,1653970 4753924\\,1653712 4753943\\,1653717 4753826\\,1653706 4753856\\,1653684 4753777\\,1653693 4753842\\,1653673 4753945\\,1653711 4754005\\,1653710 4754130\\,1653740 4754206\\,1653724 4754277\\,1653697 4754339\\,1653421 4754490\\,1653315 4754445\\,1653315 4754383\\,1653333 4754345\\,1653319 4754295\\,1653194 4754293\\,1653175 4754284\\,1653176 4754267\\,1653205 4754216\\,1653341 4754096\\,1653460 4753953\\,1653499 4753934\\,1653580 4753936\\,1653597 4753911\\,1653588 4753893\\,1653285 4753811\\,1653180 4753818\\,1653085 4753728\\,1653020 4753760\\,1652960 4753760\\,1652927 4753719\\,1652918 4753556\\,1652861 4753598\\,1652710 4753629\\,1652601 4753591\\,1652559 4753503\\,1652566 4753446\\,1652588 4753350\\,1652663 4753254\\,1652518 4753369\\,1652474 4753473\\,1652418 4753540\\,1652357 4753575\\,1652202 4753577\\,1652024 4753619\\,1651880 4753675\\,1651792 4753710\\,1651657 4753898\\,1651590 4753938\\,1651556 4753921\\,1651570 4753817\\,1651672 4753625\\,1651689 4753464\\,1651778 4753346\\,1651747 4753306\\,1651800 4753225\\,1651935 4753087\\,1652046 4753095\\,1652215 4753074\\,1652146 4752989\\,1652137 4752937\\,1652153 4752861\\,1652152 4752728\\,1652210 4752675\\,1652252 4752535\\,1652305 4752467\\,1652393 4752422\\,1652482 4752292\\,1652583 4752303\\,1652584 4752271\\,1652623 4752250\\,1652575 4752216\\,1652548 4752174\\,1652574 4752094\\,1652683 4752018\\,1652598 4751967\\,1652557 4752110\\,1652483 4752240\\,1652373 4752381\\,1652319 4752413\\,1652241 4752378\\,1652258 4752474\\,1652213 4752566\\,1652193 4752653\\,1652175 4752680\\,1652130 4752695\\,1652114 4752796\\,1652043 4752915\\,1651999 4752950\\,1651939 4752942\\,1651884 4752893\\,1651886 4752975\\,1651839 4753013\\,1651740 4753052\\,1651686 4753047\\,1651668 4753029\\,1651690 4752991\\,1651708 4752873\\,1651713 4752733\\,1651621 4752553\\,1651583 4752426\\,1651579 4752514\\,1651674 4752697\\,1651689 4752805\\,1651670 4752937\\,1651615 4753063\\,1651555 4753113\\,1651496 4753130\\,1651368 4753253\\,1651320 4753269\\,1651295 4753260\\,1651258 4753232\\,1651254 4753168\\,1651191 4753178\\,1651121 4753167\\,1651082 4753131\\,1651030 4753033\\,1651054 4752975\\,1651196 4752862\\,1651261 4752801\\,1651273 4752780\\,1651260 4752776\\,1651017 4752968\\,1650939 4752995\\,1650879 4752951\\,1650864 4752915\\,1650866 4752807\\,1650915 4752774\\,1650904 4752739\\,1650841 4752708\\,1650749 4752712\\,1650715 4752679\\,1650691 4752466\\,1650732 4752368\\,1650780 4752307\\,1650885 4751964\\,1650823 4752082\\,1650758 4752149\\,1650736 4752195\\,1650714 4752189\\,1650669 4752112\\,1650690 4752281\\,1650608 4752398\\,1650534 4752455\\,1650448 4752446\\,1650335 4752497\\,1650265 4752504\\,1650182 4752458\\,1650149 4752420\\,1650116 4752337\\,1650112 4752271\\,1650164 4752127\\,1650204 4752098\\,1650312 4752076\\,1650425 4752084\\,1650358 4752012\\,1650354 4751957\\,1650420 4751845\\,1650332 4751869\\,1650300 4751836\\,1650300 4751788\\,1650359 4751644\\,1650442 4751645\\,1650414 4751613\\,1650419 4751562\\,1650500 4751475\\,1650416 4751516\\,1650398 4751511\\,1650394 4751484\\,1650418 4751391\\,1650460 4751332\\,1650485 4751219\\,1650531 4751134\\,1650542 4751121\\,1650799 4751170\\,1650971 4751164\\,1650927 4751137\\,1650899 4751089\\,1650802 4751116\\,1650705 4751049\\,1650710 4750998\\,1650747 4750936\\,1650521 4751113\\,1650511 4751143\\,1650431 4751154\\,1650454 4751187\\,1650439 4751230\\,1650405 4751237\\,1650362 4751200\\,1650386 4751251\\,1650433 4751299\\,1650388 4751377\\,1650380 4751454\\,1650350 4751486\\,1650339 4751523\\,1650274 4751515\\,1650163 4751432\\,1650190 4751543\\,1650199 4751708\\,1650149 4751873\\,1650073 4751927\\,1649994 4751931\\,1649926 4751913\\,1649824 4751978\\,1649794 4751982\\,1649736 4751950\\,1649682 4751889\\,1649647 4751825\\,1649637 4751750\\,1649619 4751784\\,1649616 4751929\\,1649677 4751980\\,1649748 4752087\\,1649735 4752132\\,1649617 4752250\\,1649608 4752321\\,1649469 4752379\\,1649350 4752450\\,1649264 4752530\\,1649259 4752554\\,1649185 4752586\\,1649022 4752595\\,1648940 4752622\\,1648881 4752605\\,1648820 4752562\\,1648739 4752465\\,1648710 4752403\\,1648711 4752324\\,1648802 4752268\\,1649118 4752177\\,1649104 4752158\\,1648999 4752125\\,1648983 4752104\\,1649118 4751920\\,1649066 4751960\\,1649006 4751974\\,1648930 4751945\\,1648825 4751942\\,1648730 4751883\\,1648733 4751799\\,1648783 4751737\\,1648763 4751668\\,1648783 4751541\\,1648798 4751525\\,1648760 4751476\\,1648766 4751416\\,1648717 4751386\\,1648697 4751336\\,1648686 4751162\\,1648772 4750955\\,1648698 4751012\\,1648504 4751109\\,1648270 4751111\\,1648165 4751075\\,1648147 4751055\\,1648134 4750980\\,1648157 4750777\\,1648074 4750642\\,1648061 4750544\\,1648080 4750439\\,1648159 4750349\\,1648000 4750355\\,1647778 4750270\\,1647776 4750217\\,1647697 4750154\\,1647691 4750068\\,1647637 4749999\\,1647643 4749920\\,1647698 4749812\\,1647684 4749758\\,1647658 4749761\\,1647604 4749828\\,1647530 4750017\\,1647452 4750058\\,1647355 4750049\\,1647217 4750079\\,1647132 4750001\\,1647057 4749966\\,1646985 4749897\\,1646913 4749860\\,1647041 4750055\\,1647023 4750060\\,1647057 4750134\\,1647076 4750248\\,1647044 4750377\\,1646989 4750428\\,1646810 4750403\\,1646713 4750361\\,1646644 4750364\\,1646534 4750286\\,1646463 4750128\\,1646418 4750091\\,1646330 4750084\\,1646314 4750067\\,1646074 4749943\\,1646019 4749803\\,1646030 4749682\\,1645936 4749424\\,1645851 4749406\\,1645685 4749433\\,1645611 4749384\\,1645512 4749363\\,1645528 4749415\\,1645644 4749449\\,1645806 4749623\\,1645859 4749759\\,1645854 4749836\\,1645829 4749877\\,1645752 4749853\\,1645751 4749863\\,1645930 4749966\\,1645778 4750626\\,1645816 4750680\\,1645877 4750722\\,1645870 4750734\\,1645854 4750727\\,1645798 4750687\\,1645740 4750689\\,1645384 4751346\\,1645104 4751793\\,1644959 4752056\\,1644802 4752263\\,1644541 4752519\\,1644511 4752535\\,1644466 4752506\\,1644512 4752550\\,1644504 4752570\\,1644457 4752598\\,1644409 4752600\\,1644306 4752740\\,1644166 4752887\\,1644097 4752913\\,1644070 4752950\\,1643862 4753094\\,1643817 4753107\\,1643781 4753097\\,1643773 4753153\\,1643717 4753189\\,1643668 4753270\\,1643617 4753278\\,1643600 4753244\\,1643601 4753285\\,1643632 4753305\\,1643626 4753315\\,1643584 4753295\\,1643591 4753325\\,1643564 4753358\\,1643542 4753373\\,1643519 4753353\\,1643519 4753378\\,1643448 4753441\\,1643439 4753430\\,1643385 4753465\\,1643302 4753544\\,1643091 4753693\\,1642941 4753778\\,1642907 4753782\\,1642874 4753754\\,1642902 4753802\\,1642800 4753863\\,1642696 4753968\\,1642561 4754064\\,1642312 4754222\\,1642163 4754297\\,1642121 4754252\\,1642142 4754291\\,1641998 4754378\\,1641931 4754397\\,1641898 4754348\\,1641915 4754387\\,1641864 4754430\\,1641755 4754497\\,1641722 4754507\\,1641699 4754482\\,1641705 4754496\\,1641661 4754535\\,1641519 4754608\\,1641503 4754608\\,1641489 4754579\\,1641492 4754611\\,1641316 4754693\\,1641299 4754696\\,1641284 4754666\\,1641286 4754694\\,1641146 4754750\\,1641106 4754764\\,1641084 4754736\\,1641100 4754779\\,1641077 4754793\\,1640898 4754862\\,1640879 4754833\\,1640892 4754869\\,1640832 4754920\\,1640811 4754928\\,1640778 4754902\\,1640789 4754932\\,1640742 4754945\\,1640701 4754908\\,1640728 4754871\\,1640647 4754906\\,1640624 4754931\\,1640663 4754913\\,1640677 4754969\\,1640648 4755009\\,1640607 4755007\\,1640599 4754995\\,1640614 4754976\\,1640545 4755016\\,1640585 4755001\\,1640593 4755022\\,1640590 4755054\\,1640559 4755086\\,1640513 4755081\\,1640503 4755130\\,1640474 4755150\\,1640446 4755135\\,1640455 4755113\\,1640420 4755138\\,1640439 4755136\\,1640448 4755156\\,1640439 4755177\\,1640406 4755173\\,1640414 4755141\\,1640364 4755178\\,1640391 4755172\\,1640398 4755189\\,1640380 4755233\\,1640315 4755259\\,1640303 4755248\\,1640311 4755233\\,1640252 4755268\\,1640263 4755270\\,1640251 4755303\\,1640056 4755420\\,1639883 4755497\\,1639862 4755479\\,1639873 4755513\\,1639841 4755482\\,1639849 4755512\\,1639779 4755560\\,1639474 4755712\\,1639237 4755801\\,1639260 4755894\\,1639347 4756080\\,1639306 4756352\\,1639537 4756790\\,1639538 4756948\\,1639587 4757058\\,1639631 4757094\\,1639646 4757161\\,1639621 4757187\\,1639617 4757218\\,1639638 4757282\\,1639784 4757511\\,1639820 4757707\\,1639873 4757831\\,1639870 4757892\\,1639906 4757836\\,1639933 4757821\\,1640081 4757807\\,1640083 4757784\\,1639943 4757696\\,1639851 4757591\\,1639856 4757481\\,1639915 4757369\\,1639905 4757347\\,1639786 4757286\\,1639752 4757199\\,1639772 4757098\\,1639742 4756973\\,1639745 4756914\\,1639765 4756809\\,1639827 4756737\\,1639793 4756675\\,1639790 4756639\\,1639828 4756591\\,1639843 4756460\\,1639978 4756269\\,1639998 4756261\\,1640088 4756316\\,1640192 4756424\\,1640235 4756510\\,1640291 4756534\\,1640302 4756458\\,1640326 4756434\\,1640328 4756407\\,1640454 4756342\\,1640470 4756156\\,1640513 4756126\\,1640544 4756130\\,1640583 4756081\\,1640615 4756105\\,1640657 4756096\\,1640732 4756061\\,1640776 4756020\\,1640806 4756040\\,1640837 4756169\\,1640800 4756216\\,1640741 4756436\\,1640771 4756606\\,1640794 4756598\\,1640865 4756501\\,1640913 4756379\\,1640916 4756322\\,1640963 4756267\\,1641140 4756307\\,1641172 4756297\\,1641194 4756255\\,1641236 4756314\\,1641324 4756380\\,1641125 4756121\\,1641104 4756037\\,1641010 4755956\\,1641015 4755906\\,1640980 4755867\\,1640985 4755799\\,1641006 4755773\\,1641118 4755715\\,1641227 4755687\\,1641160 4755745\\,1641128 4755798\\,1641115 4755856\\,1641145 4755877\\,1641299 4755876\\,1641222 4755924\\,1641213 4755948\\,1641335 4756042\\,1641543 4755971\\,1641592 4755934\\,1641650 4755847\\,1641658 4755938\\,1641722 4755972\\,1641763 4756024\\,1641773 4756025\\,1641755 4755956\\,1641990 4755940\\,1642020 4755918\\,1642014 4755864\\,1641944 4755831\\,1641834 4755740\\,1641819 4755614\\,1641855 4755549\\,1641805 4755452\\,1641839 4755384\\,1641854 4755302\\,1641959 4755262\\,1642010 4755130\\,1642043 4755200\\,1642082 4755239\\,1642332 4755325\\,1642400 4755372\\,1642434 4755432\\,1642388 4755655\\,1642331 4755696\\,1642248 4755723\\,1642230 4755749\\,1642238 4755772\\,1642263 4755795\\,1642295 4755795\\,1642437 4755730\\,1642462 4755681\\,1642445 4755582\\,1642482 4755361\\,1642549 4755338\\,1642591 4755202\\,1642630 4755136\\,1642627 4755058\\,1642595 4754926\\,1642589 4754685\\,1642576 4754644\\,1642579 4754584\\,1642634 4754533)\\,(1652624 4754127\\,1652583 4754121\\,1652570 4754048\\,1652516 4754027\\,1652510 4753938\\,1652529 4753860\\,1652549 4753837\\,1652576 4753849\\,1652609 4753920\\,1652685 4754010\\,1652690 4754095\\,1652624 4754127)\\,(1651970 4753945\\,1651991 4753885\\,1652110 4753748\\,1652252 4753730\\,1652310 4753699\\,1652362 4753701\\,1652452 4753675\\,1652445 4753701\\,1652242 4753843\\,1652195 4753943\\,1652115 4754031\\,1652083 4754127\\,1652047 4754172\\,1651956 4754215\\,1651925 4754204\\,1651926 4754161\\,1651989 4754028\\,1651968 4753997\\,1651970 4753945)\\,(1642397 4754829\\,1642366 4754849\\,1642375 4754789\\,1642353 4754745\\,1642269 4754751\\,1642324 4754708\\,1642401 4754732\\,1642429 4754815\\,1642397 4754829)\\,(1651965 4754892\\,1651941 4754869\\,1651896 4754889\\,1651868 4754884\\,1651829 4754838\\,1651745 4754831\\,1651645 4754766\\,1651635 4754745\\,1651655 4754690\\,1651763 4754674\\,1651834 4754637\\,1651848 4754599\\,1651920 4754572\\,1651934 4754528\\,1651927 4754466\\,1651989 4754417\\,1652012 4754420\\,1652044 4754397\\,1652141 4754429\\,1652194 4754430\\,1652223 4754333\\,1652272 4754316\\,1652340 4754342\\,1652365 4754377\\,1652372 4754438\\,1652342 4754544\\,1652260 4754638\\,1652285 4754662\\,1652300 4754724\\,1652270 4754779\\,1652265 4754849\\,1652244 4754866\\,1652154 4754877\\,1651996 4754989\\,1651968 4754968\\,1651965 4754892)\\,(1647766 4750454\\,1647792 4750394\\,1647836 4750375\\,1647895 4750377\\,1647939 4750429\\,1647912 4750475\\,1647848 4750504\\,1647799 4750499\\,1647775 4750483\\,1647766 4750454)\\,(1647641 4751169\\,1647633 4751150\\,1647709 4751182\\,1647844 4751191\\,1647824 4751322\\,1647764 4751359\\,1647650 4751326\\,1647657 4751220\\,1647641 4751169)\\,(1646325 4762626\\,1646359 4762589\\,1646420 4762598\\,1646392 4762731\\,1646353 4762736\\,1646317 4762716\\,1646309 4762687\\,1646325 4762626)\\,(1653522 4756032\\,1653443 4756027\\,1653418 4755990\\,1653506 4755955\\,1653574 4755835\\,1653406 4755818\\,1653357 4755782\\,1653364 4755737\\,1653294 4755744\\,1653259 4755728\\,1653254 4755708\\,1653287 4755677\\,1653265 4755655\\,1653279 4755598\\,1653292 4755582\\,1653376 4755566\\,1653535 4755603\\,1653676 4755613\\,1653732 4755603\\,1653734 4755520\\,1653671 4755432\\,1653664 4755380\\,1653701 4755327\\,1653761 4755320\\,1653755 4755275\\,1653767 4755251\\,1653838 4755233\\,1653898 4755344\\,1653879 4755415\\,1653915 4755493\\,1653959 4755774\\,1653962 4755847\\,1653938 4755910\\,1653864 4756016\\,1653817 4756046\\,1653610 4756067\\,1653522 4756032)))';
			//this._newGeometryViewparams = encodeURIComponent('POLYGON((965523.68377232947386801 5388020.56055717170238495,2315632.81207791296765208 5389637.45771681889891624,2317249.70923756016418338 5389637.45771681889891624,2317249.70923756016418338 4383927.4244161332026124,965523.68377232959028333 4383927.4244161332026124,965523.68377232947386801 5388020.56055717170238495))');
			Ext.Panel.prototype.buttonAlign = 'left';

			this.areaSelection = new gxp.form.SelDamageArea(Ext.apply({
						localeGeoserverUrl : this.localeGeoserverUrl, //"http://159.213.57.108/geoserver/ows?",
						remoteGeoserverUrl : this.remoteGeoserverUrl, //"http://www502.regione.toscana.it:80/wfsvector/com.rt.wfs.RTmap/wfs",
						map : app.mapPanel.map,
						mapPanel : app.mapPanel
					}, this.outputConfig));


            var matrixStore = new GeoExt.data.FeatureStore({ 
                 id: "matrixStore",
                 fields: [{
                    "name": "count",              
                    "mapping": "count"
                  },{
                    "name": "matrix_cod",              
                    "mapping": "matrix_cod"
                  },{
                    "name": "matrix",              
                    "mapping": "matrix"
                  }],
                 proxy: this.getWFSStoreProxy('distinct_matrix', null, 'matrix',
                                                'monitoraggio:' + this._newMonitoringViewparams + 
                                                ';geometria:' + this._newGeometryViewparams
                                                ), 
                 autoLoad: true 
           });
			
            matrixStore.on('load', function(store, records, options) {
                //this.output.matrixType.setValue(records[0].get('matrix_cod'));
            }, this);
			
            var elementsStore = new GeoExt.data.FeatureStore({ 
                 id: "elementsStore",
                 fields: [{
                    "name": "count",              
                    "mapping": "count"
                  },{
                    "name": "element",              
                    "mapping": "element"
                  }],
                 proxy: this.getWFSStoreProxy('distinct_elements', null, 'element',
												'monitoraggio:' + this._newMonitoringViewparams +
                                                ';geometria:' + this._newGeometryViewparams +
												';tygeomat:' + this._newMatrixViewparams), 
                 autoLoad: true 
           });
           
            elementsStore.on('load', function(store, records, options) {
                //this.output.elemento.setValue(records[0].get('element'));
            }, this);			
			
            var methodStore = new GeoExt.data.FeatureStore({ 
                 id: "methodStore",
                 fields: [{
                    "name": "count",              
                    "mapping": "count"
                  },{
                    "name": "method",              
                    "mapping": "method"
                  }],
                 proxy: this.getWFSStoreProxy('distinct_method', null, 'method',
												'monitoraggio:' + this._newMonitoringViewparams +
                                                ';geometria:' + this._newGeometryViewparams +
												';tygeomat:' + this._newMatrixViewparams +
												';sigla_el:' + this._newElementViewparams), 
                 autoLoad: true 
           });
           
            methodStore.on('load', function(store, records, options) {
                //this.output.elemento.setValue(records[0].get('element'));
            }, this);				
            
			var geobasiData = new Ext.form.FormPanel({
					xtype : 'form',
					baseCls : 'x-plain',
					id : "geobasiDataForm",
					title : 'Geobasi Data',
					layout : "form",
					autoScroll : true,
					frame : true,
					forceLayout: true,
					items : [{
							xtype : 'fieldset',
							title : '<span style="color:#C53430;">Selezione Matrice - Elemento - Metodo Analitico</span>',
							anchor : '100%',
							ref : 'selectionAnalisysFieldset',
							collapsible : false,
							forceLayout : true, //needed to force to read values from this fieldset
							collapsed : false,
							iconCls : "gxp-icon-select-elem-geobasi",
							//buttonAlign: 'left',
							buttons : [{
								text : 'Reset',
								iconCls : 'cancel',
								tooltip : 'Reset',
								handler: function () {
									this.clearSelection();
								},
								scope: this
							}],
							items : [{
									xtype : 'combo',
									ref : '../matrixType',
									id : 'matrixTypeId',
									anchor : '100%',
									fieldLabel : 'Tipo Matrice',
									typeAhead : true,
									triggerAction : 'all',
									lazyRender : false,
									mode : 'remote',
									name : 'tipo_matrice',
									forceSelection : true,
									allowBlank : true,
									autoLoad : true,
									displayField : 'matrix',
									valueField : 'matrix_cod',
									readOnly : false,
                                    selectOnFocus:true,  
                                    lastQuery: '',
                                    store: matrixStore,
                                    resizable: true,
									emptyText : '-- Seleziona Tipo Matrice --',
									valueNotFoundText : '-- Seleziona Tipo Matrice --',
                                    listeners: {
                                        expand: {
                                            fn: me.onComboboxMatrixExpand,
                                            scope: me
                                        },
                                        select: {
                                            fn: me.onComboboxMatrixSelect,
                                            scope: me                            
                                        }
                                    },
									tpl : new Ext.XTemplate(
										'<tpl for=\".\" >',
                                            '<tpl  if="matrix_cod == \'01\' || matrix_cod == \'0201\'">',
                                                '<div class=\"x-combo-list-item\"><h4 style="color:#C53430;">{matrix} - (generico) -> n°: {count}<h4></div>',
                                            '</tpl>',
                                        
                                            '<tpl if="matrix_cod !== \'01\' && matrix_cod !== \'0201\'">',
                                                '<div class=\"x-combo-list-item\"><li style="padding-left:1em;">{matrix} -> n°: {count}</li></div>',
                                            '</tpl>',
										'</tpl>',
                                        {
                                            formatName: function(name){
                                                return name.toUpperCase();
                                            }
                                        }
                                    )
								}, {
									xtype : 'combo',
									ref : '../elemento',
									anchor : '100%',
									fieldLabel : 'Elemento',
									typeAhead : true,
									triggerAction : 'all',
									lazyRender : true,
									mode : 'remote',
									autoLoad : true,
									forceSelected : true,
									allowBlank : false,
									name : 'elemento',
									displayField : 'element',
									valueField : 'element',
									lastQuery: '',
									emptyText : "-- Seleziona Elemento --",
									valueNotFoundText : "-- Seleziona Elemento --",
									readOnly : false,
									disabled: true,
									listeners: {
										expand: {
											fn: me.onComboboxElemExpand,
											scope: me
										},
										select: {
											fn: me.onComboboxElemSelect,
											scope: me                            
										}
									},
									store: elementsStore,
									tpl : new Ext.XTemplate(
										'<tpl for=\".\">',
										'<div class=\"x-combo-list-item\">{element} -> n°: {count}</div>',
										'</tpl>')
								}, {
									xtype : 'combo',
									ref : '../metodoAnalitico',
									anchor : '100%',
									fieldLabel : 'Metodo Analitico',
									typeAhead : true,
									triggerAction : 'all',
									lazyRender : true,
									mode : 'remote',
									autoLoad : true,
									resizable : true,
									forceSelected : true,
									allowBlank : false,
									name : 'Metodo_analitico',
									displayField : 'method',
									valueField : 'method',
									lastQuery: '',
									emptyText : "-- Seleziona Metodo Analitico --",
									valueNotFoundText : "-- Seleziona Metodo Analitico --",
									disabled : true,
									readOnly : false,
									listeners: {
										expand: {
											fn: me.onComboboxMetAnExpand,
											scope: me
										},
										select: {
											fn: me.onComboboxMetAnSelect,
											scope: me                            
										}
									},	
									store: methodStore,
									tpl : new Ext.XTemplate(
										'<tpl for=\".\">',
										'<div class=\"x-combo-list-item\">{method} -> n°: {count}</div>',
										'</tpl>')
								}
							]
						},
						
						this.areaSelection, 
						
						{
							xtype : 'fieldset',
							title : '<span style="color:#C53430;">Selezione presenza monitoraggio</span>',
							anchor : '100%',
							ref : 'comboView1',
							iconCls : 'gxp-icon-geobasi-monitoraggio',
							collapsible : true,
							forceLayout : true, //needed to force to read values from this fieldset
							collapsed : false,
							listeners: {
								expand: function(){
									for(var tool in app.tools){            
										if(app.tools[tool].ptype == "gxp_maingeobasi"){  
											app.tools[tool].adjustLayout();
										}                          
									}
								},
								'collapse': function(){
									for(var tool in app.tools){            
										if(app.tools[tool].ptype == "gxp_maingeobasi"){  
											app.tools[tool].adjustLayout();
										}                          
									}
								}									
							},							
							items : [{
									xtype : 'combo',
									ref : '../monitoraggio',
									id : 'monitoraggioId',
									anchor : '100%',
									fieldLabel : this.selMonitoraggio,
									typeAhead : true,
									triggerAction : 'all',
									lazyRender : false,
									mode : 'local',
									name : 'tipomonitoraggio',
									forceSelected : true,
									allowBlank : false,
									autoLoad : true,
									displayField : 'label',
									valueField : 'coeff',
									value : "01",
									readOnly : false,
									listeners: {
										select: this.clearSelection,
										scope:this
									},
									store : new Ext.data.JsonStore({
										fields : [{
												name : 'name',
												dataIndex : 'name'
											}, {
												name : 'label',
												dataIndex : 'label'
											}, {
												name : 'coeff',
												dataIndex : 'coeff'
											}, {
												name : 'shortName',
												dataindex : 'shortName'
											}, {
												name : 'cid',
												dataindex : 'cid'
											}
										],
										data : [{
												label : 'Tutte le tipologie',
												coeff : "01"
											}, {
												label : 'Monitoraggio SI',
												coeff : "02"
											}, {
												label : 'Monitoraggio NO',
												coeff : "03"
											}
										]
									})
								}
							]
						}, {
							xtype : 'fieldset',
							title : '<span style="color:#C53430;">Selezione intervallo temporale</span>',
							anchor : '100%',
							ref : 'rangeyear',
							collapsible : true,
							forceLayout : true, //needed to force to read values from this fieldset
							collapsed : false,
							iconCls : "gxp-icon-time-range",
							listeners: {
								expand: function(fieldset){
									for(var tool in app.tools){            
										if(app.tools[tool].ptype == "gxp_maingeobasi"){  
											app.tools[tool].adjustLayout();
										}                          
									}
									//fieldset.syncSize();
									fieldset.doLayout(false,true);
								},
								'collapse': function(fieldset){
									for(var tool in app.tools){            
										if(app.tools[tool].ptype == "gxp_maingeobasi"){  
											app.tools[tool].adjustLayout();
										}                          
									}
									//fieldset.syncSize();
									fieldset.doLayout(false,true);									
								}																	
							},								
							items : [{
									xtype : 'checkbox',
									anchor : '100%',
									fieldLabel : 'Includi valori nulli',
									ref : 'allownull',
									name : 'allownull',
									checked : true
								}, {
									ref : 'yearRangeSelector',
									xtype : 'yearrangeselector',
									anchor : '100%',
									listeners : {
										scope : this,
										change : function (start, end) {
											//this.output.rangeyear.referenceYear.setText(end);
										},
										afterrender : function (component) {
											this.setMinMaxValues();
											if (this.output.rangeyear.yearRangeSelector != component)
												return;
										}
									}
								}
							]
							/*,listeners:{
							scope:this,
							'expand': function(component) {
							this.setMinMaxValues();
							if(this.output.rangeyear.yearRangeSelector!=component)return;
							}
							}*/
						}, //,this.uploadPanelForm
						{
							xtype : 'fieldset',
							title : '<span style="color:#C53430;">Metodi trasformazione dati</span>',
							anchor : '100%',
							ref : 'comboView2',
							collapsible : true,
							forceLayout : true, //needed to force to read values from this fieldset
							collapsed : true,
							iconCls : "gxp-icon-select-log-geobasi",
							listeners: {
								expand: function(fieldset){
									for(var tool in app.tools){            
										if(app.tools[tool].ptype == "gxp_maingeobasi"){  
											app.tools[tool].adjustLayout();
										}                          
									}
									fieldset.doLayout(false,true);	
								},
								'collapse': function(fieldset){
									for(var tool in app.tools){            
										if(app.tools[tool].ptype == "gxp_maingeobasi"){  
											app.tools[tool].adjustLayout();
										}                          
									}
									fieldset.doLayout(false,true);	
								}								
							},								
							items : [{
									fieldLabel : this.selElabMethod,
									xtype : 'radiogroup',
									anchor : '100%',
									autoHeight : true,
									checkboxToggle : true,
									name : 'elabMethodType',
									ref : 'elabMethodType',
									autoHeight : true,
									defaultType : 'radio', // each item will be a radio button
									items : [{
											boxLabel : 'Valori reali',
											name : 'elabmethodtype',
											inputValue : 2,
											checked : true
										}, {
											boxLabel : 'Scala logaritmica',
											name : 'elabmethodtype',
											inputValue : 1
										}
									]
								}
							]
						}, {
							xtype : "panel",
							layout : 'fit',
							autoScroll : true,
							title : "DOWNLOAD SELEZIONE",
							iconCls : 'gxp-icon-download-csv-geobasi',
							buttons : [{
									text : 'Scarica Selezione (CSV)',
									iconCls : 'gxp-icon-download-csv-geobasi',
									tooltip : 'Scarica Selezione (CSV)',
									url : this.dataUrl,
									chartID : "notAdded_download",
									pagePosition : [10000, 0],
									xtype : 'gxp_geobasiDataDownloadButton',
									ref : '../submitButtonDownload',
									target : this,
									form : this,
									disabled : false,
									filter : this.areaSelection,
									addedLayer : false
								}, {
									text : 'Visualizza Selezione',
									iconCls : "gxp-icon-map-filter-geobasi",
									tooltip : 'Visualizza Selezione',
									handler : function () {
										Ext.MessageBox.show({
											title : 'Informazione',
											msg : 'Funzionalità in fase di implementazione!',
											buttons : Ext.Msg.OK,
											animEl : 'elId',
											icon : Ext.MessageBox.INFO
										});

										Ext.MessageBox.getDialog().getEl().setStyle("zIndex", 100000);
										return;
									}
								}
							]
						}, {
							xtype : "panel",
							layout : 'fit',
							autoScroll : true,
							title : "ANALISI STATISTICA GRAFICO NUMERICA",
							iconCls : "gxp-icon-analisi-statistica-geobasi",
							buttons : [{
									text : 'Box Plot',
									iconCls : "gxp-icon-geobasi-boxplot",
									tooltip : 'Visualizza Grafico',
									url : this.dataUrl,
									chartID : "notAdded_boxPlot",
									pagePosition : [10000, 0],
									xtype : 'gxp_geobasiDataBoxPlotButton',
									ref : '../submitButtonBoxPlot',
									target : this,
									form : this,
									disabled : false,
									filter : this.areaSelection,
									addedLayer : false
								}, {
									text : 'Istogramma',
									iconCls : "gxp-icon-geobasi-barchart",
									tooltip : 'Visualizza Grafico',
									url : this.dataUrl,
									chartID : "notAdded_barChart",
									pagePosition : [10000, 400],
									xtype : 'gxp_geobasiDataBarChartButton',
									ref : '../submitButtonColumnChart',
									target : this,
									form : this,
									disabled : false,
									filter : this.areaSelection,
									addedLayer : false
								}, {
									text : 'Curva Cumul.',
									iconCls : "gxp-icon-geobasi-curvacum",
									tooltip : 'Visualizza Grafico',
									url : this.dataUrl,
									chartID : "notAdded_curvaCum",
									pagePosition : [10000, 800],
									xtype : 'gxp_geobasiDataCurvaCumButton',
									ref : '../submitButtonCurvaCum',
									target : this,
									form : this,
									disabled : false,
									filter : this.areaSelection,
									addedLayer : false
									/*,
									handler: function() {
									Ext.MessageBox.show({
									title: 'Informazione',
									msg: 'Funzionalità in fase di implementazione!',
									buttons: Ext.Msg.OK,
									animEl: 'elId',
									icon: Ext.MessageBox.INFO
									});

									Ext.MessageBox.getDialog().getEl().setStyle("zIndex", 100000);
									return;
									}
									 */
								}
							]
						}
					]
				});

			config = Ext.apply(geobasiData, config || {});

			this.output = gxp.plugins.geobasi.GeobasiData.superclass.addOutput.call(this, config);

		},

        onComboboxMatrixExpand: function (field, eOpts) {

			var matrixStore, monitoringValue, newMonitoringViewparams, newGeometryViewparams, newProtocol;
			
            matrixStore = field.getStore();
            monitoringValue = this.output.monitoraggio.getValue();
			
            newMonitoringViewparams = this.setNewMonitoringViewparams(monitoringValue);
            
            //newGeometryViewparams = this.getGeometryViewParams() || this._newGeometryViewparams;

			//if(this._newMonitoringViewparams !== newMonitoringViewparams || this._newGeometryViewparams !== newGeometryViewparams){
			if(this._newMonitoringViewparams !== newMonitoringViewparams){
				//newProtocol = this.getWFSStoreProxy('distinct_matrix', null, 'matrix', newGeometryViewparams ? 'monitoraggio:' + newMonitoringViewparams + ';geometria:' + newGeometryViewparams.replace(/,/g,'\\,') : 'monitoraggio:' + newMonitoringViewparams + ';geometria:' + this._newGeometryViewparams);
				newProtocol = this.getWFSStoreProxy('distinct_matrix', null, 'matrix', 'monitoraggio:' + newMonitoringViewparams + ';geometria:' + this._newGeometryViewparams);
				matrixStore.proxy.protocol = newProtocol.protocol;
				matrixStore.reload();
				this._newMonitoringViewparams = newMonitoringViewparams;
                this._newGeometryViewparams = newGeometryViewparams;
			}

        },

		onComboboxMatrixSelect: function (field, eOpts) {
			var me = this;
			me.output.elemento.enable();
			me.output.elemento.reset();
			me.output.metodoAnalitico.reset();
			me.output.metodoAnalitico.disable();
		},

		onComboboxElemExpand: function (field, eOpts) {

			var elementsStore, monitoringValue, matrixValue, newMonitoringViewparams, newMatrixViewparams, newProtocol;
			
            elementsStore = field.getStore();
            monitoringValue = this.output.monitoraggio.getValue();
			matrixValue = this.output.matrixType.getValue();
			newMatrixViewparams = matrixValue;
			
			newMonitoringViewparams = this.setNewMonitoringViewparams(monitoringValue);
            
            //myFilter = this.getGeometryViewParams();
			
			if(this._newMonitoringViewparams !== newMonitoringViewparams || this._newMatrixViewparams !== newMatrixViewparams){
				newProtocol = this.getWFSStoreProxy('distinct_elements', null, 'element', 'monitoraggio:'+newMonitoringViewparams+';tygeomat:'+newMatrixViewparams + ';geometria:' + this._newGeometryViewparams);    
				elementsStore.proxy.protocol = newProtocol.protocol;
				elementsStore.reload();
				this._newMonitoringViewparams = newMonitoringViewparams;
				this._newMatrixViewparams = newMatrixViewparams;
			}
			
		},		

		onComboboxElemSelect: function (field, eOpts) {
			var me = this;
			me.output.metodoAnalitico.enable();
			me.output.metodoAnalitico.reset();
		},
		
		onComboboxMetAnExpand: function (field, eOpts) {
			
			var methodStore, monitoringValue, matrixValue, elementValue, newMonitoringViewparams, newMatrixViewparams, newElementViewparams, newProtocol;
			
            methodStore = field.getStore();
            monitoringValue = this.output.monitoraggio.getValue();
			matrixValue = this.output.matrixType.getValue();
			elementValue = this.output.elemento.getValue();
			newMatrixViewparams = matrixValue;
			newElementViewparams = elementValue;
			
			newMonitoringViewparams = this.setNewMonitoringViewparams(monitoringValue);
            
            //myFilter = this.getGeometryViewParams();
			
			if(this._newMonitoringViewparams !== newMonitoringViewparams || this._newMatrixViewparams !== newMatrixViewparams || this._newElementViewparams !== newElementViewparams){
				newProtocol = this.getWFSStoreProxy('distinct_method', null, 'method', 'monitoraggio:'+newMonitoringViewparams+';tygeomat:'+newMatrixViewparams+';sigla_el:'+newElementViewparams + ';geometria:' + this._newGeometryViewparams);    
				methodStore.proxy.protocol = newProtocol.protocol;
				methodStore.reload();
				this._newMonitoringViewparams = newMonitoringViewparams;
				this._newMatrixViewparams = newMatrixViewparams;
				this._newElementViewparams = newElementViewparams;
			}
			
		},		

		onComboboxMetAnSelect: function (field, eOpts) {

		},
	
		setMinMaxValues : function () {
			this.appMask = new Ext.LoadMask(this.output.rangeyear.el, {
					msg : this.mainLoadingMask
				});
			this.appMask.show();
			Ext.Ajax.request({
				scope : this,
				url : this.dataUrl,
				method : 'POST',
				params : {
					service : "WFS",
					version : "1.1.0",
					//geometryName: "geom",
					request : "GetFeature",
					typeName : "geobasi:geobasi_data_analisi",
					outputFormat : "json",
					propertyName : "max,min"
				},
				success : function (result, request) {
					try {
						var jsonData2 = Ext.util.JSON.decode(result.responseText);
					} catch (e) {
						Ext.Msg.alert("Error", "Error parsing data from the server");
						this.appMask.hide();
						return;
					}
					if (jsonData2.features.length <= 0) {
						Ext.Msg.alert("Nessun dato", "Dati non disponibili per questo criterio di ricerca");
						this.appMask.hide();
						return;
					}

					var min = jsonData2.features[0].properties.min;
					var max = jsonData2.features[0].properties.max;
					
					var yearRangeSelector = this.output.rangeyear.yearRangeSelector;

					yearRangeSelector.slider.setMinValue(min);
					yearRangeSelector.slider.setMaxValue(max);
					yearRangeSelector.slider.setValue(0, min, true);
					yearRangeSelector.slider.setValue(1, max, true);

					yearRangeSelector.startValue.setValue(min);
					yearRangeSelector.endValue.setValue(max);
					this.appMask.hide();

				},
				failure : function (result, request) {
					Ext.Msg.alert("Error", "Server response error");
					this.appMask.hide();
				}
			});
		},
		
		clearSelection: function(){
			this.output.matrixType.reset();
			this.output.elemento.reset();
			this.output.metodoAnalitico.reset();
			this.output.elemento.disable();
			this.output.metodoAnalitico.disable();			
		},
        
        getWFSStoreProxy: function(featureName, filter, sortBy, viewparams){
			
            var filterProtocol=new OpenLayers.Filter.Logical({
                type: OpenLayers.Filter.Logical.AND,
                filters: new Array()
            });
            if(filter) {
                if(filter.type== "FID")
                    filterProtocol=filter;
               else
                  filterProtocol.filters.push(filter);
            }
            var proxy= new GeoExt.data.ProtocolProxy({ 
                protocol: new OpenLayers.Protocol.WFS({ 
                    url: this.getWFSStoreProxyProp.wfsURL, 
                    featureType: featureName, 
                    readFormat: new OpenLayers.Format.GeoJSON(),
                    featureNS: this.getWFSStoreProxyProp.featureNS,
                    filter: filterProtocol, 
					//srsName: "EPSG:3003",					
                    outputFormat: this.getWFSStoreProxyProp.outputFormat,
                    version: this.getWFSStoreProxyProp.wfsVersion,
                    sortBy: sortBy || undefined,
                    viewparams: viewparams || undefined			
                }) 
            });

            return proxy;         
            
        },

        setNewMonitoringViewparams: function(monitoringValue){
        
            var newMonitoringViewparams;
			switch (monitoringValue){
				case "01":
					newMonitoringViewparams = ' IS NOT NULL'
					break;
				case "02":
					newMonitoringViewparams = ' = true'
					break;
				case "03":
					newMonitoringViewparams = ' = false'
					break;
			}
            return newMonitoringViewparams;
            
        },
        
        getGeometryViewParams: function(){

            if (this.areaSelection.filterPolygon && this.areaSelection.filterPolygon.value) {
                var wkt_options = {};
                var wkt = new OpenLayers.Format.WKT();
                var out = wkt.write(this.areaSelection.selectGeometry);

                var geomCollectionIndex = out.indexOf('GEOMETRYCOLLECTION(');
                if (geomCollectionIndex == 0) {
                    out = out.substring(19, out.length - 1);
                }            
                myFilter = out;
            } else if (this.areaSelection.filterCircle && this.areaSelection.filterCircle.value) {
                myFilter = this.areaSelection.filterCircle;
            } else if (this.areaSelection.searchWFSComboAlluvioni && this.areaSelection.searchWFSComboAlluvioni.geometry) {
                
                myFilter = this.areaSelection.searchWFSComboAlluvioni.geometry;
                
            } else if (this.areaSelection.searchWFSComboRoccia && this.areaSelection.searchWFSComboRoccia.geometry) {
                
                myFilter = this.areaSelection.searchWFSComboRoccia.geometry;
                
            } else if (this.areaSelection.searchWFSComboComuniRT && this.areaSelection.searchWFSComboComuniRT.geometry) {

                myFilter = this.areaSelection.searchWFSComboComuniRT.geometry;

            } else {
                myFilter = false;
            }        
        
            return myFilter;
            
        }

	});

Ext.preg(gxp.plugins.geobasi.GeobasiData.prototype.ptype, gxp.plugins.geobasi.GeobasiData);